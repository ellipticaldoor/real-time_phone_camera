<!DOCTYPE html>
<html>
<head>
	<title>camara1</title>
	<link href="/css/style.css" rel="stylesheet">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script type="text/javascript" src="/js/lib/jquery.min.js"></script>
	<script type="text/javascript" src="/js/lib/peer.js"></script>
	<script>
		navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

		var peer = new Peer({debug: true, host: 'localhost', port: 9000, path: '/'});

		peer.on('open', function(){
			$('#my-id').text(peer.id);
		});

		// Click handlers setup
		$(function() {
			$('#make-call').click(function(){
				// Initiate a call!
				var call = peer.call($('#callto-id').val(), window.localStream);
			});

			$('#end-call').click(function(){
				window.existingCall.close();
				step2();
			});

			// Retry if getUserMedia fails
			$('#step1-retry').click(function(){
				$('#step1-error').hide();
				step1();
			});

			// Get things started
			step1();
		});

		function step1 () {
			// Get audio/video stream
			navigator.getUserMedia({audio: false, video: true}, function(stream){
				// Set your video displays
				// $('#my-video').prop('src', URL.createObjectURL(stream));

				window.localStream = stream;
				step2();
			}, function(){ $('#step1-error').show(); });
		}

		function step2 () {
			$('#step1, #step3').hide();
			$('#step2').show();
		}
	</script>
</head>

<body>
	<div class="pure-g">
		<div class="pure-u-1-3">
			<div id="step1">
				<p>Please click `allow` on the top of the screen so we can
				access your webcam and microphone for calls.</p>

				<div id="step1-error">
					<p>Failed to access the webcam and microphone. Make sure to
					run this demo on an http server and click allow when asked
					for permission by the browser.</p><a class=
					"pure-button pure-button-error" href="#" id=
					"step1-retry">Try again</a>
				</div>
			</div><!-- Make calls to others -->

			<div id="step2">
				<p>Your id: <span id="my-id">...</span></p>

				<p>Share this id with others so they can call you.</p>

				<h3>Make a call</h3>

				<div class="pure-form">
					<input id="callto-id" placeholder="Call user id..." type=
					"text" value="pantalla1"> <a class="pure-button pure-button-success" href="#"
					id="make-call">Call</a>
				</div>
			</div><!-- Call in progress -->

			<div id="step3">
				<p>Currently in call with <span id="their-id">...</span></p>

				<p><a class="pure-button pure-button-error" href="#" id=
				"end-call">End call</a></p>
			</div>
		</div>
	</div>
</body>
</html>